# NG(불합격) 처리 및 정기점검 연계 워크플로우

## 📋 목차
1. [NG 자동 연계 프로세스](#ng-자동-연계-프로세스)
2. [정기점검 연계 구조](#정기점검-연계-구조)
3. [통합 흐름도](#통합-흐름도)

---

## 🔍 NG 자동 연계 프로세스

### CAMS 시스템 관리 담당 - 시스템 규칙 관리

```
┌─────────────────────────────────────────────────────────────┐
│        [CAMS 시스템 관리 담당] - 시스템 규칙 관리            │
│                                                               │
│  • 점검표 관리 (일상/정기)                                     │
│  • 알람 기준 설정                                              │
│  • NG 유형 및 긴급도 기준 정의                                 │
│  • 자동 연계 규칙 설정                                         │
└─────────────────────────────────────────────────────────────┘
                            ↓
                    불합격(NG 발생)
                            ↓
```

### NG 발생 시 자동 연계 5단계

```
═══════════════════════════════════════════════════════════════
  📌 NG(불합격) 발생 시 자동 연계 프로세스
═══════════════════════════════════════════════════════════════

[1단계] NG 유형 자동 분류
┌─────────────────────────────────────────────────────────────┐
│  • Minor (경미)    → 협력사 자체 조치                          │
│    - 외관 경미한 오염                                          │
│    - 일시적 성능 저하                                          │
│    - 조정 가능한 문제                                          │
│                                                               │
│  • Major (중요)    → 수리 요청 필요                            │
│    - 부품 손상                                                 │
│    - 기능 이상                                                 │
│    - 전문 수리 필요                                            │
│                                                               │
│  • Critical (치명) → 생산중단 + 본사 즉시 알림                 │
│    - 금형 파손                                                 │
│    - 안전 위험                                                 │
│    - 생산 불가능                                               │
└─────────────────────────────────────────────────────────────┘
                            ↓
[2단계] 자동 생성 데이터
┌─────────────────────────────────────────────────────────────┐
│  생성되는 데이터:                                              │
│  • NG 알람 (qr_scan_alerts)                                   │
│    - alert_type: 'ng_detected'                                │
│    - severity: 'minor' | 'major' | 'critical'                 │
│                                                               │
│  • 점검 결과 (daily_checks)                                   │
│    - result: 'fail'                                           │
│    - ng_type: 분류된 NG 유형                                   │
│                                                               │
│  • 수리 요청 (repairs) - Major/Critical인 경우                 │
│    - status: 'requested'                                      │
│    - urgency: NG 긴급도에 따라                                 │
│                                                               │
│  • 금형상태 변경 (molds)                                       │
│    - status: 'ng' | 'under_repair' | 'stopped'                │
└─────────────────────────────────────────────────────────────┘
                            ↓
[3단계] 자동 알림 발송
┌─────────────────────────────────────────────────────────────┐
│  알림 대상:                                                    │
│                                                               │
│  • 생산처 담당자 → 즉시 알림                                   │
│    - NG 발생 내용                                              │
│    - 조치 필요 사항                                            │
│                                                               │
│  • 제작처 담당자 → 수리 필요 시 알림                           │
│    - 수리 요청 내용                                            │
│    - 예상 수리 기간                                            │
│                                                               │
│  • CAMS 시스템 관리 담당 → Critical 시 즉시 알림            │
│  • 금형개발 담당 → Critical 시 즉시 알림                      │
│    - 긴급 상황 알림                                            │
│    - 대응 조치 요청                                            │
└─────────────────────────────────────────────────────────────┘
                            ↓
[4단계] 조치 프로세스 자동 전개

┌─────────────────────────────────────────────────────────────┐
│  Case A) Minor NG - 협력사 자체 조치 가능                      │
│  ────────────────────────────────────────────────────────    │
│  1. 습합 / 세척 / 조정 실시                                    │
│     - 작업자가 QR 스캔하여 조치 시작                           │
│     - 조치 내용 기록                                           │
│                                                               │
│  2. 조치 후 QR 스캔 → 정상화 보고                              │
│     - 조치 완료 사진 첨부                                      │
│     - 정상화 확인                                              │
│                                                               │
│  3. 금형상태 자동 정상화                                       │
│     - status: 'ng' → 'production'                             │
│     - 점검 스케줄 재계산                                       │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  Case B) Major NG - 수리 필요                                 │
│  ───────────────────────────────────────────────────────────│
│  1. 수리요청 자동 생성                                         │
│     - repairs 테이블에 자동 등록                               │
│     - 수리 내용 및 긴급도 설정                                 │
│                                                               │
│  2. 귀책 협의 프로세스 시작                                     │
│     ■ 1차 협의: 생산처 ↔ 금형제작처                          │
│     - 수리 원인 분석 및 공유                                  │
│     - 귀책 당사자 1차 판단                                     │
│       * 생산처 귀책: 부적절한 사용, 관리 소홀                │
│       * 제작처 귀책: 설계/제작 결함, 재질 불량               │
│       * 자연 마모: 정상 사용 범위 내 마모                    │
│     - 협의 내용 시스템 기록 (repair_liability)              │
│     - 합의 시 → 수리 진행                                      │
│     - 합의 불가 시 → 2차 협의                                  │
│                                                               │
│     ■ 2차 협의: 본사 개입 (합의 불가 시)                     │
│     - 금형개발 담당 검토 요청                                  │
│     - 금형 사양, 사용 이력, 수리 이력 분석                     │
│     - 최종 귀책 판정                                           │
│     - 비용 처리 방안 결정                                      │
│                                                               │
│  3. 제작처로 수리 요청 전달                                    │
│     - 제작처 담당자에게 알림                                   │
│     - 귀책 협의 결과 포함                                       │
│     - 수리 접수 확인                                           │
│                                                               │
│  4. 제작처 수리 진행                                           │
│     - 수리 시작 QR 스캔                                        │
│     - 수리 진행 상태 업데이트                                  │
│                                                               │
│  5. 수리 전/중/후 사진 기록                                    │
│     - repair_photos 테이블에 저장                              │
│     - 각 단계별 사진 필수                                      │
│                                                               │
│  6. 수리 완료 후 보고 및 비용 처리                              │
│     - 수리 완료 QR 스캔                                        │
│     - 품질 확인 후 정상화                                      │
│     - 귀책에 따른 비용 청구 (repair_costs)                   │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  Case C) Critical NG - 즉시 생산중단                           │
│  ────────────────────────────────────────────────────────────│
│  1. 즉시 생산중단                                              │
│     - 금형 상태: 'stopped'                                     │
│     - 생산 라인 중지                                           │
│                                                               │
│  2. 본사 긴급 알림 (실시간)                                    │
│     - CAMS 시스템 관리 담당                                    │
│     - 금형개발 담당                                             │
│  3. 비가동 사유코드 기록                                       │
│     - downtime_records 테이블                                  │
│     - 비가동 시간 추적                                         │
│                                                               │
│  4. 임시 금형 이관 필요 시 체크리스트 자동 생성                 │
│     - 긴급 이관 절차 시작                                      │
│     - 대체 금형 확인                                           │
│                                                               │
│  5. 긴급 대응팀 배정                                           │
│     - 본사 전문가 파견                                         │
│     - 원인 분석 및 대책 수립                                   │
└─────────────────────────────────────────────────────────────┘
                            ↓
[5단계] 조치 완료
┌─────────────────────────────────────────────────────────────┐
│  조치 완료 후 자동 처리:                                       │
│                                                               │
│  • 금형상태 정상화                                             │
│    - status: 'production' 또는 'standby'                      │
│                                                               │
│  • 점검 스케줄 재계산                                          │
│    - 다음 점검 일정 자동 생성                                  │
│                                                               │
│  • 타수/생산데이터 반영                                        │
│    - 누적 타수 업데이트                                        │
│    - 생산 이력 기록                                            │
│                                                               │
│  • 조치 이력 저장                                              │
│    - NG 발생부터 해결까지 전체 이력                            │
│    - 향후 분석 및 예방 자료                                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 📅 정기점검 연계 구조

### 정기점검 기준

```
┌─────────────────────────────────────────────────────────────┐
│                    정기점검 기준                               │
│                                                               │
│  • 1차 점검: 100,000 타 (100K)                                │
│    - 기본 외관 및 기능 점검                                    │
│    - 소모품 확인                                               │
│                                                               │
│  • 2차 점검: 500,000 타 (500K)                                │
│    - 정밀 점검                                                 │
│    - 부품 교체 검토                                            │
│                                                               │
│  • 3차 점검: 1,000,000 타 (1M)                                │
│    - 전면 점검                                                 │
│    - 오버홀 검토                                               │
│                                                               │
│  ※ 기준은 CAMS 관리자가 금형별로 조정 가능                     │
└─────────────────────────────────────────────────────────────┘
```

### 정기점검 발생 조건

```
┌─────────────────────────────────────────────────────────────┐
│  조건 1: 누적타수 ≥ 예정 타수                                  │
│          → 정기점검 필요 알람 발생                             │
│                                                               │
│  조건 2: 누적타수 ≥ 예정 타수 × 90%                            │
│          → 정기점검 임박 알람 발생                             │
│                                                               │
│  예시:                                                         │
│  - 누적타수 90,000 → 1차 점검 임박 알람 (90%)                 │
│  - 누적타수 100,000 → 1차 점검 필요 알람 (100%)               │
│  - 누적타수 110,000 → 1차 점검 지연 알람 (110%)               │
└─────────────────────────────────────────────────────────────┘
```

### 정기점검 수행 절차

```
[1단계] QR 스캔 → 정기점검 선택
         ↓
         시스템이 점검 차수 자동 판단
         (누적타수 기준)
         ↓
[2단계] 표준 체크리스트 자동 로드
         ↓
┌─────────────────────────────────────────────────────────────┐
│  체크리스트 항목 (5개 카테고리):                               │
│                                                               │
│  1. 외관 점검                                                  │
│     - 균열 / 마모 / 부식 / 오염                                │
│     - 각 항목별 PASS/FAIL + 사진                               │
│                                                               │
│  2. 기능 점검                                                  │
│     - 슬라이드 / 리프터 / 이젝터 / 냉각                        │
│     - 동작 확인 + 이상 유무                                    │
│                                                               │
│  3. 치수 점검                                                  │
│     - 제품 치수 측정                                           │
│     - 공차 범위 확인                                           │
│                                                               │
│  4. 성능 점검                                                  │
│     - 사이클 타임 / 불량률 / 온도                              │
│     - 기준 대비 비교                                           │
│                                                               │
│  5. 문서 점검                                                  │
│     - 이력 확인 / 수리 기록 / 변경 사항                        │
│     - 문서 완전성 확인                                         │
└─────────────────────────────────────────────────────────────┘
         ↓
[3단계] 항목별 PASS/FAIL 기록 + 사진 첨부
         ↓
         각 항목마다:
         - PASS: 정상
         - FAIL: NG 프로세스 자동 연동
         ↓
[4단계] FAIL 발생 시 자동으로 NG 프로세스 연동
         ↓
         NG 유형 자동 분류 (Minor/Major/Critical)
         → 해당 조치 프로세스 시작
         ↓
[5단계] 전체 PASS 시 다음 점검 일정 자동 생성
         ↓
         inspection_schedules 테이블 업데이트
         - next_inspection_shots 계산
         - next_inspection_date 예측
```

### 정기점검 결과 자동 연계

```
┌─────────────────────────────────────────────────────────────┐
│  전체 PASS                                                     │
│  ────────────────────────────────────────────────────────────│
│  • 예정 타수 업데이트                                          │
│    - 다음 점검 차수의 타수로 설정                              │
│                                                               │
│  • 다음 점검 일정 자동 생성                                    │
│    - 예상 생산 속도 기반 날짜 계산                             │
│                                                               │
│  • 금형상태 정상 유지                                          │
│    - status: 'production'                                     │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  일부 FAIL (Minor/Major)                                      │
│  ────────────────────────────────────────────────────────────│
│  • 수리/보전 프로세스 자동 연동                                │
│    - repairs 테이블에 자동 등록                                │
│                                                               │
│  • NG 알람 자동 생성                                           │
│    - 담당자에게 알림 발송                                      │
│                                                               │
│  • 금형상태 변경                                               │
│    - status: 'ng' 또는 'under_repair'                         │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  Critical FAIL                                                │
│  ────────────────────────────────────────────────────────────│
│  • 생산중단                                                    │
│    - status: 'stopped'                                        │
│                                                               │
│  • 본사 긴급 알림                                              │
│    - 실시간 SMS/이메일                                         │
│                                                               │
│  • 긴급 대응팀 배정                                            │
│    - 전문가 파견 요청                                          │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔄 통합 흐름도

### 정기점검·일상점검·NG 통합 흐름

```
                    ┌──────────── PASS ────────────┐
                    │                               │
    [일상점검] ──→ PASS → 정상생산                  │
         │                                          │
         │                                          │
         └──── FAIL(NG) ───────→ NG 자동 프로세스  │
                 ↓                      ↓            │
            NG 유형 분류          Minor/Major/      │
                                  Critical          │
                                       ↓             │
                              조치 프로세스 시작    │
                                                     │
    [정기점검] ──→ PASS → 다음 주기 자동 생성       │
         │                                          │
         │                                          │
         └──── FAIL → 수리/보전 자동 연계           │
                 ↓                                   │
            NG 프로세스 연동                         │
                 ↓                                   │
         (수리/세척/습합 완료)                       │
                 ↓                                   │
         [정상화 보고] ←─────────────────────────────┘
                 ↓
    [금형 상태 정상 전환 + 점검 일정 재계산]
                 ↓
         정상 생산 재개
```

### 데이터 흐름

```
QR 스캔
   ↓
점검 실행 (일상/정기)
   ↓
결과 입력 (PASS/FAIL)
   ↓
┌─────────────┬─────────────┐
│    PASS     │    FAIL     │
└─────────────┴─────────────┘
      ↓              ↓
  정상 처리      NG 분류
      ↓              ↓
  다음 점검    Minor/Major/Critical
      ↓              ↓
  스케줄 생성   조치 프로세스
                     ↓
                 조치 완료
                     ↓
                 정상화 보고
                     ↓
                 상태 업데이트
```

---

## 📊 통계 및 분석

### NG 발생 통계

```
- NG 발생 빈도 (일/주/월)
- NG 유형별 분포
- 금형별 NG 이력
- 조치 시간 분석
- 재발 방지 효과 측정
```

### 정기점검 통계

```
- 점검 완료율
- 점검 지연율
- PASS/FAIL 비율
- 점검 소요 시간
- 점검 주기 준수율
```

---

**마지막 업데이트**: 2024-01-18
**버전**: Ver.09
