# 시스템 로그인 및 권한 관리

## 📋 목차
1. [사용자 유형](#사용자-유형)
2. [로그인 프로세스](#로그인-프로세스)
3. [권한별 메뉴 구조](#권한별-메뉴-구조)
4. [인증 방식](#인증-방식)
5. [보안 정책](#보안-정책)
6. [데이터베이스 구조](#데이터베이스-구조)

---

## 👥 사용자 유형

### 4단 사용자 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    사용자 유형 (4가지)                         │
│                                                               │
│  1. CAMS 시스템 관리 담당 (본사)                               │
│     - 시스템 관리자 권한                                       │
│     - 전체 시스템 설정 및 모니터링                             │
│     - 사용자 및 권한 관리                                      │
│                                                               │
│  2. 금형개발 담당 (본사)                                       │
│     - 금형 정보 관리 권한                                      │
│     - 금형 승인 및 검토                                        │
│     - 전사 모니터링 및 통계                                    │
│                                                               │
│  3. 금형제작처 (Maker)                                         │
│     - 담당자 / 작업자 (동일 ID 사용)                           │
│     - 설계, 제작, 수리 권한                                    │
│     - QR 코드 출력 및 부착                                     │
│                                                               │
│  4. 생산처 (Plant)                                            │
│     - 담당자 / 작업자 (동일 ID 사용)                           │
│     - 점검, 수리요청, 이관 권한                                │
│     - QR 스캔 작업                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 👥 사용자 유형 4가지 (공통 정의)

```
┌─────────────────────────────────────────────────────────────┐
│                    사용자 유형 4가지                           │
│                                                               │
│  1️⃣ CAMS 시스템 관리 담당 (본사) - system_admin               │
│     • 시스템 규칙 관리, 전사 모니터링                          │
│     • 권한 설정/감사, 사용자 관리                              │
│     • 점검표/알람 기준 설정                                    │
│     → 대시보드: /dashboard/system-admin                        │
│                                                               │
│  2️⃣ 금형개발 담당 (본사) - mold_developer                     │
│     • 금형 사양 정의·승인, 제작처 관리                         │
│     • 전사 통계/사용 기준, 수리 귀책 판정                      │
│     • 금형 생명주기 전체 관리                                  │
│     → 대시보드: /dashboard/mold-developer                      │
│                                                               │
│  3️⃣ 금형제작처 (Maker) - maker                                │
│     • 설계/제작/시운전/수리 작업                               │
│     • QR 코드 출력/부착, 현장 작업 실행                        │
│     • 귀책 협의 참여                                           │
│     → 대시보드: /dashboard/maker                               │
│                                                               │
│  4️⃣ 생산처 (Plant) - plant                                    │
│     • 양산/점검/수리요청/이관                                  │
│     • QR 스캔 기반 작업 및 생산수량 입력                       │
│     • 일상점검 및 정기점검 수행                                │
│     → 대시보드: /dashboard/plant                               │
└─────────────────────────────────────────────────────────────┘
```

**참고 문서**: `docs/WORKFLOW_SUMMARY.md`, `docs/DASHBOARD_GUIDE.md`

---

## 🔐 로그인 프로세스

### 웹 로그인 절차

```
[1단계] 로그인 페이지 접속
         ↓
[2단계] 인증 정보 입력
         ↓
     ID / Password 입력
         ↓
[3단계] 서버 인증 처리
         ↓
     • 사용자 정보 확인
     • 비밀번호 검증
     • 계정 상태 확인
     • 로그인 이력 기록
         ↓
[4단계] JWT 토큰 발급
         ↓
     토큰 유효기간: 8시간
         ↓
[5단계] 권한별 메인 화면 자동 이동
         ↓
     ┌──────────────────────────────┐
     │ CAMS 시스템 관리 담당         │
     │ → 시스템 관리 대시보드        │
     └──────────────────────────────┘
     ┌──────────────────────────────┐
     │ 금형개발 담당                 │
     │ → 금형 관리 대시보드          │
     └──────────────────────────────┘
     ┌──────────────────────────────┐
     │ 금형제작처                    │
     │ → 제작처 작업 대시보드        │
     └──────────────────────────────┘
     ┌──────────────────────────────┐
     │ 생산처                        │
     │ → 생산처 작업 대시보드        │
     └──────────────────────────────┘
```

---

## 🎯 권한별 메뉴 구조

### 1. CAMS 시스템 관리 담당 메뉴

```
┌─────────────────────────────────────────────────────────────┐
│  CAMS 시스템 관리 담당 메뉴                                    │
│  ───────────────────────────────────────────────────────────│
│                                                               │
│  📊 대시보드                                                   │
│    - 전사 통합 현황                                            │
│    - 실시간 알람 모니터링                                      │
│    - 주요 지표 요약                                            │
│                                                               │
│  ⚙️ 시스템 설정                                                │
│    - 사용자 관리                                               │
│      * 사용자 등록/수정/삭제                                   │
│      * 비밀번호 초기화                                         │
│      * 계정 잠금/해제                                          │
│    - 권한 관리                                                 │
│      * 권한 그룹 설정                                          │
│      * 메뉴별 권한 설정                                        │
│    - 점검표 관리                                               │
│      * 일상점검 체크리스트                                     │
│      * 정기점검 체크리스트                                     │
│    - 알람 기준 설정                                            │
│      * 타수 기준 설정                                          │
│      * NG 기준 설정                                            │
│                                                               │
│  🌐 전사 모니터링                                              │
│    - 통합 대시보드                                             │
│    - 실시간 알람                                               │
│    - GPS 위치 추적                                             │
│                                                               │
│  📈 통계 및 리포트                                             │
│    - 금형 현황 통계                                            │
│    - 협력사별 성과                                             │
│    - 수리 이력 분석                                            │
└─────────────────────────────────────────────────────────────┘
```

### 2. 금형개발 담당 메뉴

```
┌─────────────────────────────────────────────────────────────┐
│  금형개발 담당 메뉴                                            │
│  ───────────────────────────────────────────────────────────│
│                                                               │
│  📊 대시보드                                                   │
│    - 담당 금형 현황                                            │
│    - 승인 대기 항목                                            │
│    - 최근 활동                                                 │
│                                                               │
│  🔨 금형 관리                                                  │
│    - 금형 등록 (QR 자동 생성)                                  │
│    - 금형 정보 수정                                            │
│    - 금형 사양 관리                                            │
│                                                               │
│  ✅ 승인 및 검토                                               │
│    - 설계 승인                                                 │
│    - 시운전 결과 검토                                          │
│    - 수리 귀책 판정                                            │
│                                                               │
│  🏭 제작처 관리                                                │
│    - 제작처 선정                                               │
│    - 제작 진행 모니터링                                        │
│                                                               │
│  🌐 전사 모니터링                                              │
│    - 통합 대시보드                                             │
│    - 실시간 알람                                               │
│    - GPS 위치 추적                                             │
│                                                               │
│  📈 통계 및 리포트                                             │
│    - 금형 현황 통계                                            │
│    - 협력사별 성과                                             │
│    - 수리 이력 분석                                            │
└─────────────────────────────────────────────────────────────┘
```

### 3. 금형제작처 메뉴

```
┌─────────────────────────────────────────────────────────────┐
│  금형제작처 메뉴                                               │
│  ───────────────────────────────────────────────────────────│
│                                                               │
│  📊 대시보드                                                   │
│    - 진행 중인 작업                                            │
│    - 수리 요청 현황                                            │
│                                                               │
│  🔨 제작 관리                                                  │
│    - QR 코드 확인 및 출력                                      │
│    - 제작 진행 등록                                            │
│    - 금형 명판 부착 확인                                       │
│                                                               │
│  🧪 시운전                                                     │
│    - 시운전 결과 입력                                          │
│    - PASS/FAIL 판정                                           │
│                                                               │
│  🔧 수리 관리                                                  │
│    - 수리 요청 확인                                            │
│    - 수리 진행 등록                                            │
│    - 귀책 협의 참여                                            │
└─────────────────────────────────────────────────────────────┘
```

### 4. 생산처 메뉴

```
┌─────────────────────────────────────────────────────────────┐
│  생산처 메뉴                                                   │
│  ───────────────────────────────────────────────────────────│
│                                                               │
│  📊 대시보드                                                   │
│    - 금형 현황                                                 │
│    - 점검 일정                                                 │
│                                                               │
│  📱 QR 스캔 작업                                               │
│    - 일상점검                                                  │
│    - 정기점검                                                  │
│    - 세척/습합                                                 │
│                                                               │
│  🔧 수리 관리                                                  │
│    - 수리 요청                                                 │
│    - 귀책 협의 참여                                            │
│                                                               │
│  🚚 금형 이관                                                  │
│    - 이관 요청                                                 │
│    - 이관 체크리스트                                           │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔑 인증 방식

### JWT 기반 인증

```
JWT 토큰 구조:
- user_id: 사용자 ID
- user_type: 사용자 유형
- company_id: 소속 회사 ID
- permissions: 권한 목록
- expires_at: 만료 시간 (8시간)
```

---

## 🛡️ 보안 정책

### 비밀번호 정책
- 최소 8자 이상
- 영문 대소문자, 숫자, 특수문자 조합
- 90일마다 변경 권장

### 로그인 실패 처리
- 5회 연속 실패 시 계정 잠금
- 15분 후 자동 해제

### 세션 관리
- 유효기간: 8시간
- 비활동 30분 시 자동 로그아웃 경고

---

## 💾 데이터베이스 구조

```sql
-- 사용자 테이블
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    email VARCHAR(100),
    user_type VARCHAR(20) NOT NULL,
    company_id INTEGER,
    is_active BOOLEAN DEFAULT TRUE,
    last_login_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 로그인 이력
CREATE TABLE login_history (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    login_time TIMESTAMP DEFAULT NOW(),
    ip_address VARCHAR(45),
    login_status VARCHAR(20)
);
```

---

**마지막 업데이트**: 2024-01-18
**버전**: Ver.09
