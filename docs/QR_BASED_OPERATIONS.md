# QR 기반 전사 운영 및 이상 발생 연계

## 📋 목차
1. [QR 기반 전사 운영 구조](#qr-기반-전사-운영-구조)
2. [QR 스캔 프로세스](#qr-스캔-프로세스)
3. [GPS 위치 추적](#gps-위치-추적)
4. [이상 발생 시 자동 연계](#이상-발생-시-자동-연계)
5. [전사 연동 구조](#전사-연동-구조)

---

## 🛰️ QR 기반 전사 운영 구조

### 시스템 개요

```
┌──────────────────────────────────────────────────────────────┐
│              [QR 기반 전사 운영 구조]                          │
│                                                                │
│  핵심 원칙:                                                     │
│  • 금형마다 고유 QR 부착                                        │
│  • 모든 작업(점검/수리/이관/폐기) QR 스캔으로 시작              │
│  • GPS 자동 기록 (작업자 QR 스캔 단말 기준)                     │
│    - 헤드폰 스캐너 / 모바일 기기                                │
│  • 사용자 자동 식별                                             │
│  • 전사(본사-제작처-생산처) 동일 인터페이스 운영                │
│                                                                │
│  장점:                                                          │
│  • 빠른 접근 (QR 스캔 1초)                                      │
│  • 정확한 위치 추적 (GPS)                                       │
│  • 자동 데이터 연동                                             │
│  • 실시간 모니터링                                              │
│  • 이력 추적 가능                                               │
└──────────────────────────────────────────────────────────────┘
```

### QR 코드 구조

```
┌─────────────────────────────────────────────────────────────┐
│  QR 코드 포맷:                                                 │
│                                                               │
│  CAMS-MOLD-[M2024001]-[A3F7]
  │     │      │          │
  │     │      │          └── 체크섬 (4자리)
  │     │      └─────────── 금형코드 (8자리)
  │     └───────────────── 금형 식별자
  └─────────────────────── 시스템 식별자

※ 금형개발 담당이 금형정보 등록 시 시스템이 자동 생성
※ 제작처로 자동 배포되며, 제작처에서 명판에 부착
```

### QR 코드 생성 및 부착

```
[사전 준비] QR 코드 명판 부착
         ↓
     금형개발 담당이 금형정보 등록 시 QR 자동 생성
         ↓
     제작처로 QR 코드 자동 배포
         ↓
     제작처에서 QR 코드 출력 및 금형 명판에 부착
         ↓
──────────────────────────────────────────────

[1단계] QR 코드 스캔
         ↓
     금형정보 자동 로드
     - 금형코드
     - 금형명
     - 현재 상태
     - 현재 위지
     - 누적 타수
         ↓
[2단계] 사용자 권한 확인
         ↓
     권한별 메뉴 자동 구분
     - 본사: 승인/검토/통계
     - 제작처: 설계/제작/수리
     - 생산처: 점검/수리요청/이관
         ↓
[3단계] 작업 선택
         ↓
     선택 가능 메뉴 표시
     - 일상점검
     - 정기점검
     - 수리 요청
     - 이관 요청
     - 세부정보 조회
         ↓
[4단계] GPS 위치 기록
         ↓
     자동 기록 항목:
     - GPS 좌표 (latitude, longitude)
     - 스캔 시간
     - 사용자 ID
     - 작업 종류
         ↓
[5단계] 데이터 동기화
         ↓
     실시간 데이터 연동
     - 본사 대시보드 업데이트
     - 제작처/생산처 데이터 공유
     - 알람 발생 시 자동 알림
```

---

## 📱 QR 스캔 프로세스

### QR 스캔 기본 흐름

```
┌──────────────────────────────────────────────────────────────┐
│          ① QR 스캔 → 금형정보 자동 로드                        │
│                                                                │
│  스캔 방법:                                                     │
│  • 모바일 앱 카메라                                             │
│  • 헤드폰 스캐너 (핸즈프리)                                     │
│  • 태블릿 카메라                                                │
│                                                                │
│  자동 로드 정보:                                                │
│  • 금형 기본정보                                                │
│    - 금형코드 / 금형명 / 부품명                                 │
│    - 차종 / 제작처 / 생산처                                     │
│                                                                │
│  • 금형 상태                                                    │
│    - 현재 상태 (양산/수리중/이관중/폐기대상)                    │
│    - 상태 변경 이력                                             │
│                                                                │
│  • 누적 데이터                                                  │
│    - 누적타수 / 생산수량                                        │
│    - 마지막 점검일                                              │
│    - 다음 점검 예정일                                           │
│                                                                │
│  • 점검 일정                                                    │
│    - 일상점검 필요 여부                                         │
│    - 정기점검 임박/필요 알람                                    │
│                                                                │
│  • 수리 이력                                                    │
│    - 최근 수리 내역                                             │
│    - 진행 중인 수리                                             │
│                                                                │
│  • 권한별 메뉴                                                  │
│    - 생산처/제작처/본사 구분 자동 적용                          │
│    - 사용자 권한에 따른 메뉴 표시                               │
└──────────────────────────────────────────────────────────────┘
                            ↓
┌──────────────────────────────────────────────────────────────┐
│        ② 작업 선택 (일상/정기점검 · 수리 · 이관 등)            │
│                                                                │
│  생산처 메뉴:                                                   │
│  • 일상점검 + 생산수량 입력                                     │
│  • 정기점검 (1차/2차/3차)                                       │
│  • 수리 요청                                                    │
│  • 세척 / 습합                                                  │
│  • 금형 이관 요청                                               │
│  • 폐기 요청                                                    │
│                                                                │
│  제작처 메뉴:                                                   │
│  • 제작 진행 상황 업데이트                                      │
│  • 시운전 결과 입력                                             │
│  • 수리 진행 / 완료                                             │
│  • 금형 출고 / 입고                                             │
│                                                                │
│  본사 메뉴:                                                     │
│  • 금형 정보 수정                                               │
│  • 승인 / 검토                                                  │
│  • 통계 / 리포트 조회                                           │
│  • 시스템 설정                                                  │
│                                                                │
│  공통 원칙:                                                     │
│  • 모든 프로세스가 QR 스캔으로 시작                             │
│  • 데이터 일관성 확보                                           │
│  • 실시간 동기화                                                │
└──────────────────────────────────────────────────────────────┘
```

### QR 세션 관리

```
┌─────────────────────────────────────────────────────────────┐
│  QR 세션 (qr_sessions 테이블)                                 │
│                                                               │
│  생성 시점: QR 스캔 시                                         │
│  유효 시간: 8시간                                              │
│                                                               │
│  저장 정보:                                                    │
│  • 세션 ID (UUID)                                             │
│  • 금형 ID                                                     │
│  • 사용자 ID                                                   │
│  • 스캔 시간                                                   │
│  • GPS 위치 (위도/경도)                                        │
│  • 스캔 장소 (생산처/제작처)                                   │
│  • 세션 상태 (active/expired)                                 │
│                                                               │
│  활용:                                                         │
│  • 작업 이력 추적                                              │
│  • 위치 이동 감지                                              │
│  • 사용 패턴 분석                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 📍 GPS 위치 추적

### GPS 자동 기록

```
┌─────────────────────────────────────────────────────────────┐
│  GPS 위치 추적 시스템                                          │
│                                                               │
│  기준 위치: 작업자 QR 스캔 단말 기준                           │
│  • 헤드폰 스캐너 (Bluetooth 연결 스마트폰)                     │
│  • 모바일 기기 (스마트폰/태블릿)                               │
│                                                               │
│  정확도:                                                       │
│  • 실내: 10-50m (Wi-Fi 보조)                                  │
│  • 실외: 5-10m (GPS)                                          │
│  • 목표: 50m 오차 이내                                         │
│                                                               │
│  기록 시점:                                                    │
│  • QR 스캔 시 자동 기록                                        │
│  • 작업 시작/완료 시                                           │
│  • 이관 시 출발/도착 위치                                      │
│                                                               │
│  저장 정보:                                                    │
│  • 위도 (latitude)                                            │
│  • 경도 (longitude)                                           │
│  • 정확도 (accuracy)                                          │
│  • 타임스탬프                                                  │
│  • 장소명 (역지오코딩)                                         │
└─────────────────────────────────────────────────────────────┘
```

### GPS 활용 시나리오

```
[시나리오 1] 금형 위치 추적
┌─────────────────────────────────────────────────────────────┐
│  • 실시간 금형 위치 파악                                       │
│  • 지도에 마커로 표시                                          │
│  • 마커 클러스터링 (다수 금형)                                 │
│  • 위치 이력 조회                                              │
└─────────────────────────────────────────────────────────────┘

[시나리오 2] 위치 이탈 감지
┌─────────────────────────────────────────────────────────────┐
│  • 등록된 생산처 위치와 비교                                   │
│  • 허용 범위 초과 시 알람                                      │
│  • 무단 이동 감지                                              │
│  • 관리자에게 즉시 알림                                        │
└─────────────────────────────────────────────────────────────┘

[시나리오 3] 이관 경로 추적
┌─────────────────────────────────────────────────────────────┐
│  • 출발지 → 목적지 경로 기록                                   │
│  • 이동 시간 측정                                              │
│  • 중간 경유지 확인                                            │
│  • 이관 완료 확인                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 🚨 이상 발생 시 자동 연계

### 이상 발생 감지

```
┌─────────────────────────────────────────────────────────────┐
│  [1] 현장에서 이상 입력 발생                                   │
│                                                               │
│  이상 유형:                                                    │
│  • NG (외관/기능/냉각/제품불량)                                │
│    - 점검 시 FAIL 항목 발견                                    │
│    - 작업자가 직접 NG 보고                                     │
│                                                               │
│  • 생산수량 급감                                               │
│    - 일일 생산량이 평균 대비 30% 이하                          │
│    - 시스템 자동 감지                                          │
│                                                               │
│  • 금형 온도/압력 이상                                         │
│    - 센서 데이터 기반 (연동 시)                                │
│    - 기준 범위 초과 시 알람                                    │
│                                                               │
│  • GPS 위치 이탈                                               │
│    - 등록된 위치에서 벗어남                                    │
│    - 허용 범위 초과 (예: 500m)                                 │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  [2] 시스템 자동 분류                                          │
│                                                               │
│  분류 기준:                                                    │
│  • Normal NG (경미)                                           │
│    → 협력사 자체 조치 필요                                     │
│    → 생산 계속 가능                                            │
│                                                               │
│  • Major (중요)                                               │
│    → 수리 요청 필요                                            │
│    → 생산 일시 중단 가능                                       │
│                                                               │
│  • Critical (치명)                                            │
│    → 즉시 생산중지 + 본사 알람                                 │
│    → 긴급 대응 필요                                            │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  [3] 자동 생성되는 연계 데이터                                 │
│                                                               │
│  생성 데이터:                                                  │
│  • 알람 (qr_scan_alerts)                                      │
│    - alert_type: 'ng_detected', 'location_alert', etc.        │
│    - severity: 'low', 'medium', 'high', 'urgent'              │
│    - message: 상세 알람 내용                                   │
│                                                               │
│  • 점검 결과 (daily_checks / inspections)                     │
│    - result: 'fail'                                           │
│    - ng_details: NG 상세 내용                                  │
│    - photos: 증빙 사진                                         │
│                                                               │
│  • 수리요청 (repairs)                                          │
│    - status: 'requested'                                      │
│    - urgency: 'normal', 'high', 'critical'                    │
│    - description: 수리 내용                                    │
│                                                               │
│  • 누적타수 (shots)                                            │
│    - 생산수량 기반 자동 업데이트                               │
│    - 점검 스케줄 재계산 트리거                                 │
│                                                               │
│  • 금형상태 변경 (molds.status)                                │
│    - 'production' → 'ng'                                      │
│    - 'production' → 'under_repair'                            │
│    - 'production' → 'stopped'                                 │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  [4] 자동 알림 발송                                            │
│                                                               │
│  알림 채널:                                                    │
│  • 시스템 내 알림 (실시간)                                     │
│  • 이메일 (중요도에 따라)                                      │
│  • SMS (긴급 시)                                               │
│  • 모바일 푸시 (앱 사용 시)                                    │
│                                                               │
│  알림 대상:                                                    │
│  • 협력사 담당자 → 조치 요청                                   │
│    - NG 발생 내용                                              │
│    - 조치 방법 안내                                            │
│                                                               │
│  • 제작처 → 수리 대응 요청                                     │
│    - 수리 필요 내용                                            │
│    - 예상 수리 기간                                            │
│                                                               │
│  • 본사 → Critical 대응 알림 (실시간)                          │
│    - 긴급 상황 요약                                            │
│    - 즉시 대응 요청                                            │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  [5] 자동 연계 프로세스 발생                                   │
│                                                               │
│  Case A) 협력사 자체 조치 가능 (Minor NG)                      │
│  • 습합/세척 요청 자동 생성                                    │
│  • 조치 후 QR 스캔 → 완료 보고                                 │
│  • 금형상태 자동 정상화                                        │
│                                                               │
│  Case B) 수리 필요 (Major)                                    │
│  • 제작처로 자동 수리요청 전달                                 │
│  • 제작처 QR 스캔 → 수리 전/중/후 단계별 기록                  │
│  • 수리 완료 후 정상화                                         │
│                                                               │
│  Case C) Critical 비가동 (중단사유코드 포함)                   │
│  • 생산중지 기록 자동 생성                                     │
│  • 본사 긴급 알림                                              │
│  • 긴급 이관 가능 (자동 체크리스트 생성)                       │
│  • 대응팀 배정                                                 │
│                                                               │
│  Case D) GPS 위치 이탈                                        │
│  • 현장 확인 요청 자동 발송                                    │
│  • 금형 이동 로그 생성                                         │
│  • 관리자 승인 필요 여부 확인                                  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  [6] 조치 완료 후 자동 반영                                    │
│                                                               │
│  • 금형상태 정상화                                             │
│    - status: 'production' 또는 'standby'                      │
│                                                               │
│  • 점검 스케줄 재계산                                          │
│    - 다음 점검 일정 자동 생성                                  │
│                                                               │
│  • 타수 기록 업데이트                                          │
│    - 누적 타수 반영                                            │
│                                                               │
│  • 수리완료 이력 반영                                          │
│    - 수리 내역 저장                                            │
│    - 향후 분석 자료                                            │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔁 전사 연동 구조

### 본사 ↔ 제작처 ↔ 생산처 연동

```
┌──────────────────────────────────────────────────────────────┐
│              CAMS 시스템 관리 담당 (본사)                     │
│                                                                │
│  역할:                                                          │
│  • 시스템 규칙 관리                                             │
│  • 전사 데이터 통합 모니터링                                    │
│  • 대시보드 및 리포트                                           │
│  • 사용자 권한 관리                                             │
└──────────────────────────────────────────────────────────────┘
                         ↓ 자동연동
┌──────────────────────────────────────────────────────────────┐
│                  금형개발 담당 (본사)                         │
│                                                                │
│  역할:                                                          │
│  • 금형 개발 / 사양 / 승인                                      │
│  • 제작처 선정 및 관리                                        │
│  • 설계 검토 및 승인                                          │
│                                                                │
│  데이터 흐름:                                                   │
│  • 금형 사양 → 제작처 자동 연동                                 │
│  • 제작처/생산처 데이터 → 본사 실시간 집계                      │
│  • 승인/검토 → 제작처/생산처 자동 배포                          │
└──────────────────────────────────────────────────────────────┘
                         │ 자동연동
                         ▼
┌──────────────────────────────────────────────────────────────┐
│                      제작처 (Maker)                            │
│                                                                │
│  역할:                                                          │
│  • 설계 → 제작 → 시운전                                         │
│  • 제작 진행 상황 업데이트                                      │
│  • 수리 대응                                                    │
│                                                                │
│  데이터 흐름:                                                   │
│  • 본사 사양 수신 → 제작 시작                                   │
│  • 제작 진행률 → 본사 실시간 공유                               │
│  • 제작완료 시 → 금형마스터 자동 생성                           │
│  • 수리 요청 수신 → 수리 진행 → 완료 보고                       │
└────────────────────────┬─────────────────────────────────────┘
                         │ 제작완료 시 자동 금형마스터 생성
                         ▼
┌──────────────────────────────────────────────────────────────┐
│                      생산처 (Plant)                            │
│                                                                │
│  역할:                                                          │
│  • 양산 · 점검 · 수리 · 이관 · 폐기                            │
│  • 일상/정기점검 수행                                           │
│  • 생산수량 입력                                                │
│                                                                │
│  데이터 흐름:                                                   │
│  • 금형마스터 수신 → 양산 시작                                  │
│  • 점검/수리/타수 정보 → 본사·제작처 실시간 공유                │
│  • 수리 요청 → 제작처 자동 전달                                 │
│  • 이관/폐기 요청 → 본사 승인 프로세스                          │
└────────────────────────┬─────────────────────────────────────┘
                         │ 모든 기록이 QR 기반으로 실시간 공유
                         ▼
┌──────────────────────────────────────────────────────────────┐
│         본사 대시보드에서 전체 통합 모니터링                │
│      (CAMS 시스템 관리 담당 + 금형개발 담당)            │
│                                                                │
│  • 전체 금형 현황 (위치/상태/타수)                              │
│  • 실시간 알람 및 이슈                                          │
│  • 점검 스케줄 및 완료율                                        │
│  • 수리 진행 현황                                               │
│  • 협력사별 성과 분석                                           │
│  • GPS 기반 금형 위치 맵                                        │
└──────────────────────────────────────────────────────────────┘
```

### 데이터 동기화

```
실시간 동기화 항목:
┌─────────────────────────────────────────────────────────────┐
│  • 금형 상태 변경                                              │
│  • 점검 결과 (PASS/FAIL)                                      │
│  • 생산수량 및 타수                                            │
│  • 알람 발생                                                   │
│  • 수리 요청 및 진행 상태                                      │
│  • GPS 위치 정보                                               │
│  • 이관 진행 상황                                              │
└─────────────────────────────────────────────────────────────┘

배치 동기화 항목:
┌─────────────────────────────────────────────────────────────┐
│  • 통계 데이터 (일/주/월)                                      │
│  • 리포트 생성                                                 │
│  • 이력 데이터 아카이빙                                        │
└─────────────────────────────────────────────────────────────┘
```

---

## 📊 QR 시스템 효과

### 정량적 효과

```
• 작업 시간 단축: 평균 70% 감소
  - 기존: 금형 검색 + 로그인 + 메뉴 탐색 (3-5분)
  - QR: 스캔 + 자동 로드 (5-10초)

• 데이터 정확도 향상: 95% → 99.9%
  - 수동 입력 오류 제거
  - 자동 데이터 연동

• 위치 추적 정확도: 50m 이내
  - GPS 기반 실시간 추적
  - 위치 이탈 즉시 감지

• 알람 대응 시간: 평균 80% 단축
  - 실시간 알림
  - 자동 프로세스 연계
```

### 정성적 효과

```
• 사용자 편의성 대폭 향상
  - 직관적인 인터페이스
  - 빠른 접근

• 관리 투명성 확보
  - 전체 이력 추적
  - 실시간 모니터링

• 협업 효율성 증대
  - 본사-제작처-생산처 실시간 연동
  - 정보 공유 자동화

• 예방 보전 강화
  - 조기 이상 감지
  - 자동 알람 시스템
```

---

**마지막 업데이트**: 2024-01-18
**버전**: Ver.09
